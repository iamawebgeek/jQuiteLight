/*!
 *
 * jQuery Smart Search Query Highlight Plugin
 *
 * @author iamwebdesigner batkamolodec@gmail.com
 * @license Apache License Version 2.0
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 */!function(t){if(!t)throw new Error("jQuery library must be loaded first");var e,i,r=function(e,i,n){this.options=t.extend({},r.DEFAULTS,i),this.$el=t(e),s(this.options,this.$el),this.marks=[],this.isRegex=!1,this.baseQuery=!1,n instanceof RegExp?(this.query=n,this.isRegex=!0):this.options.useSmartBehavior?(this.baseQuery=n.toString(),this.query=this.smartBehavior(n),this.isRegex=!0):(n=n.toString(),this.query=this.options.ignoreCase?n.toLowerCase():n),this.mark(e)},s=function(e,i){/[a-zA-Z0-9]+/.test(e.markTag)||t.error("Invalid marking tag!"),t.isArray(e.skippedTags)||t.error("Option skippedTags expected to be an array"),t.isFunction(e.afterMark)&&t.isFunction(e.beforeMark)||t.error("Options afterMark and beforeMark must be functions"),-1!==t.inArray(i.prop("tagName").toLowerCase(),e.skippedTags)&&t.error("Given element is to be skipped!")};r.DEFAULTS={skippedTags:["script","style"],ignoreCase:!0,escape:!1,useSmartBehavior:!1,beforeMark:function(){return!0},afterMark:function(){},markTag:"span",markData:{"class":"marked-text"},markCss:{}},r.prototype.smartBehavior=function(t){return new RegExp("[^\\W]*"+t+"[^\\W]*",this.options.ignoreCase?"gi":"g")},r.prototype.queryPosition=function(t){return this.isRegex?t.search(this.query):this.options.ignoreCase?t.toLowerCase().indexOf(this.query):t.indexOf(this.query)},r.prototype.destroy=function(){t(this.marks).each(function(){t(this).replaceWith(t(this).html())})},r.prototype.wrapString=function(i){return e=t("<"+this.options.markTag+"/>",this.options.markData),e.append(i),e.css(this.options.markCss),this.marks.push(e),this.options.afterMark.call(e),e},r.prototype.smartBehaviorMatchLogic=function(t){if(!this.baseQuery)return!1;var e=this.baseQuery.length,i=t.length;return!(3>e&&i==i)},r.prototype.mark=function(e){var r=function(e,i){var r=t(i).siblings().get(e);void 0!==r&&null!==r.nextSibling&&s.call(this,e+1,r.nextSibling)},s=function(e,s){if(3===s.nodeType){var n=this.queryPosition(s.textContent);if(-1!==n)if(this.isRegex){var o=s.textContent.match(this.query)[0];this.options.beforeMark(o)&&this.smartBehaviorMatchLogic(o)&&(i=s.splitText(this.queryPosition(s.textContent)),i.splitText(o.length),i.parentNode.replaceChild(this.wrapString(t(i).clone()).get(0),i),r.call(this,e,s))}else this.options.beforeMark(this.query)&&(i=s.splitText(this.queryPosition(s.textContent)),i.splitText(this.query.length),i.parentNode.replaceChild(this.wrapString(t(i).clone()).get(0),i),r.call(this,e,s))}else 1===s.nodeType&&s.childNodes.length>0&&-1===t.inArray(s.tagName,this.options.skippedTags)&&this.mark(s)};t.each(e.childNodes,t.proxy(s,this))},t.fn.textOnly=function(){return this.clone().children().remove().end().text()},t.fn.mark=function(e,i){return t.trim(e)&&""!==this.text().trim()?this.each(function(){if(t.isArray(e))return t.each(e,t.proxy(function(e,r){t(this).mark(r,i)},this));var s=t(this).data("marker");void 0===s&&(s=[]),s.push(new r(this,i,e)),t(this).data("marker",s)}):this}}(window.jQuery);