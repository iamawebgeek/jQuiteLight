!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):window.jQuery)}(function(t){var e,i,r=function(e,i,s){this.options=t.extend({},r.DEFAULTS,i),this.normalizeNodes(e),this.$el=t(e),n(this.options,this.$el),this.marks=[],this.isRegex=!1,this.baseQuery=!1,s instanceof RegExp?(this.query=s,this.isRegex=!0):this.options.useSmartBehavior?(this.baseQuery=s.toString(),this.query=this.smartBehavior(s),this.isRegex=!0):(s=s.toString(),this.query=this.options.ignoreCase?s.toLowerCase():s),this.mark(e)},s=function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=t.isPlainObject(i[r])&&t.isPlainObject(e[r])?s(e[r]||{},i[r]):i[r]);return e},n=function(e,i){/[a-zA-Z0-9]+/.test(e.markTag)||t.error("Invalid marking tag!"),t.isArray(e.skippedTags)||t.error("Option skippedTags expected to be an array"),t.isFunction(e.afterMark)&&t.isFunction(e.beforeMark)||t.error("Options afterMark and beforeMark must be functions"),-1!==t.inArray(i.prop("tagName").toLowerCase(),e.skippedTags)&&t.error("Given element is to be skipped!")},o=t.fn.mark;r.DEFAULTS={skippedTags:["script","style"],ignoreCase:!0,escape:!1,useSmartBehavior:!1,beforeMark:function(){return!0},afterMark:function(){},markTag:"span",markData:{"class":"marked-text"},markCss:{}},r.prototype.smartBehavior=function(t){return new RegExp("[^\\W]*"+t+"[^\\W]*",this.options.ignoreCase?"gi":"g")},r.prototype.queryPosition=function(t){return this.isRegex?t.search(this.query):this.options.ignoreCase?t.toLowerCase().indexOf(this.query):t.indexOf(this.query)},r.prototype.destroy=function(){t(this.marks).each(function(){t(this).replaceWith(t(this).html())}),this.normalizeNodes(this.$el.get(0))},r.prototype.normalizeNodes=function(t){t.normalize&&t.normalize()},r.prototype.wrapString=function(i){return e=t("<"+this.options.markTag+"/>",this.options.markData),e.append(i),e.css(this.options.markCss),this.marks.push(e),this.options.afterMark.call(e),e},r.prototype.smartBehaviorMatchLogic=function(t){if(!this.baseQuery)return!1;var e=this.baseQuery.length,i=t.length;return!(3>e&&i==i)},r.prototype.mark=function(e){var r=function(e,i){var r=t(i).siblings().get(e);void 0!==r&&null!==r.nextSibling&&s.call(this,e+1,r.nextSibling)},s=function(e,s){if(3===s.nodeType){var n=this.queryPosition(s.textContent);if(-1!==n)if(this.isRegex){var o=s.textContent.match(this.query)[0];this.options.beforeMark(o)&&this.smartBehaviorMatchLogic(o)&&(i=s.splitText(this.queryPosition(s.textContent)),i.splitText(o.length),i.parentNode.replaceChild(this.wrapString(t(i).clone()).get(0),i),r.call(this,e,s))}else this.options.beforeMark(this.query)&&(i=s.splitText(this.queryPosition(s.textContent)),i.splitText(this.query.length),i.parentNode.replaceChild(this.wrapString(t(i).clone()).get(0),i),r.call(this,e,s))}else 1===s.nodeType&&s.childNodes.length>0&&-1===t.inArray(s.tagName,this.options.skippedTags)&&this.mark(s)};t.each(e.childNodes,t.proxy(s,this))},t.fn.mark=function(e,i){return t.trim(e)&&""!==this.text().trim()?this.each(function(){if(t.isArray(e))return t.each(e,t.proxy(function(e,r){var n=i,o=r;t.isPlainObject(r)&&r.query&&(o=r.query,delete r.query,n=s(i,r)),t(this).mark(o,n)},this));var n=t(this).data("marker");void 0===n&&(n=[]),n.push(new r(this,i,e)),t(this).data("marker",n)}):this},t.fn.mark.Marker=r,t.fn.mark.noConflict=function(){return t.fn.mark=o,this}});